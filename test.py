import gmpy2
from gmpy2 import *
import llr
from llr import P_generic

cases = {
    1999: [29, 53, 131, 179, 215, 219, 429, 669, 831, 1131, 1263, 1703, 3029, 5141],
    #2001: [26, 29, 34, 39, 50, 53, 71, 93, 119, 169, 211, 213, 513, 551, 809, 1081, 1106, 1226, 1923, 2071, 2123, 2141, 2811, 3291, 4617, 4857, 5257, 5714, 7153, 7801, 80631]
}

for k, ns in cases.items():
    for n in ns:
        print("testcase >>>", k, n)
        result = llr.is_riesel_prime(k, n)
        assert(result == True)
        result = llr.is_riesel_prime(k, n + 2)
        assert(result == False)

# raise the precision so at least our tests pass
gmpy2.get_context().precision=2 ** 12
assert(pow(xmpz(2), xmpz(3)) == 8)
assert(pow(xmpz(7), xmpz(31)) == 157775382034845806615042743)
# k:5 b:2 n:32
# N = k * 2 ^ 32 - 1 = 21474836479
assert(P_generic(1, xmpz(4)) == 4)
assert(P_generic(5, xmpz(4)) == 724)
assert(P_generic(2, xmpz(724)) == 524174)
assert(P_generic(2, xmpz(524174)) == 274758382274)
assert(P_generic(2, xmpz(17060344526)) == 291055355345818164674)
assert(P_generic(2, xmpz(291055355345818164674)) == 84713219875480482488869261558493781526274)
assert(P_generic(2, xmpz(84713219875480482488869261558493781526274)) == 7176329621671501453076568852489247776568376218009120175741348930545473480952323074)
assert(P_generic(xmpz(2001), xmpz(4)) == xmpz(29311808472274514318939208505369091894387578222753245428790554468993761678325959027595882791637490947174765362200320687018075612753927799788088976393276924825300924518178339519183478095909431014382646167591129818054568369304458650724819068909381870717142349613530706138114295882464164286724255291638830738405859638795118950905189573023636073522790839077482407105414681914685301045563497183708700090478294906672112124235403949798490403129466212568600596414368852048929117056176075495155479804351649804423935603526404496452118007631555479067385101889218033931227439980252615744241138323564839222582144964822163387896858931915853274995482711187707274741282127709585243116344126702374964030964852428173972407847302205615303698305098630954011172620818471585638851962019488650203821659962977547466400936992061094952896237590532484683155080386322503296383302798097484127069677501068030610990945953527310527087885039462658612577912362005251651084028405688612839046225720627503139934207287168511706342567721243777553371087498164008660495159045513643515607250572545132912503172819312135298379525130399765879244652985018430487836809683822783587848557584452))
